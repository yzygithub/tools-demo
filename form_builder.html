<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>表单构建器</title>
  <meta name="keywords" content="">
  <meta name="description" content="">
  <link rel="shortcut icon" href="favicon.png">
  <link href="./zui/css/zui.min.css" rel="stylesheet">
  <link href="./css/checkbox&radio.css" rel="stylesheet">

  <style>
    .gray-bg {
      background-color: #f7f7f7;
    }

    .wrapper {
      padding: 0 20px;
    }

    .wrapper-content {
      padding: 20px;
    }

    .droppable-active {
      background-color: #ffe !important
    }

    .form-body .col-md-6,
    .form-body .col-md-12 {
      min-height: 450px
    }

    .form-edit {
      margin: 0 10px;
      padding: 10px 0;
    }

    .form-edit:focus {
      outline: 1px solid #ddd;
    }

    .draggable {
      cursor: move;
    }

    .inl-blk {
      display: inline-block;
    }

    .head-tools {
      display: inline-block;
      float: right;
      margin-top: 6px;
    }

    .btn-div {
      margin-top: 20px;
    }
  </style>

</head>

<body class="gray-bg">
  <div class="wrapper wrapper-content">

    <div class="row">
      <!--tool left -->
      <div class="col-sm-4">
        <div class="panel">
          <div class="panel-heading">
            <h5>元素</h5>
            <div class="ibox-tools">
              <a class="collapse-link">
                <i class="fa fa-chevron-up"></i>
              </a>
              <a class="dropdown-toggle" data-toggle="dropdown" href="form_editors.html#">
                <i class="fa fa-wrench"></i>
              </a>
              <ul class="dropdown-menu dropdown-user">
                <li>
                  <a href="form_editors.html#">选项1</a>
                </li>
                <li>
                  <a href="form_editors.html#">选项2</a>
                </li>
              </ul>
              <a class="close-link">
                <i class="fa fa-times"></i>
              </a>
            </div>
          </div>
          <div class="panel-body">
            <div class="alert alert-info">
              拖拽左侧的表单元素到右侧区域，即可生成相应的HTML代码，表单代码，轻松搞定！
            </div>
            <form role="form" class="form-horizontal">
              <div class="form-group draggable">
                <label class="col-sm-3 control-label">文本框：</label>
                <div class="col-sm-9">
                  <input type="text" name="" class="form-control" placeholder="请输入文本">
                  <span class="help-block m-b-none">说明文字</span>
                </div>
              </div>
              <div class="form-group draggable">
                <label class="col-sm-3 control-label">密码框：</label>
                <div class="col-sm-9">
                  <input type="password" class="form-control" name="password" placeholder="请输入密码">
                </div>
              </div>
              <div class="form-group draggable">
                <label class="col-sm-3 control-label">下拉列表：</label>
                <div class="col-sm-9">
                  <select class="form-control" name="">
                    <option>选项 1</option>
                    <option>选项 2</option>
                    <option>选项 3</option>
                    <option>选项 4</option>
                  </select>
                </div>
              </div>
              <div class="form-group draggable">
                <label class="col-sm-3 control-label">文件域：</label>
                <div class="col-sm-9">
                  <input type="file" name="" class="form-control">
                </div>
              </div>
              <div class="form-group draggable">
                <label class="col-sm-3 control-label">纯文本：</label>

                <div class="col-sm-9">
                  <p class="form-control-static">这里是纯文字信息</p>
                </div>
              </div>
              <div class="form-group draggable">
                <label class="col-sm-3 control-label">单选框：
                </label>

                <div class="col-sm-9">
                  <div class="radio-custom radio-primary radio-inline">
                    <input type="radio" id="inputRadiosUnchecked" name="inputRadios">
                    <label for="inputRadiosUnchecked">未选中</label>
                  </div>
                  <div class="radio-custom radio-primary radio-inline">
                    <input type="radio" id="inputRadiosChecked" name="inputRadios" checked="">
                    <label for="inputRadiosChecked">选中</label>
                  </div>
                </div>
              </div>
              <div class="form-group draggable">
                <label class="col-sm-3 control-label">复选框：</label>

                <div class="col-sm-9">
                  <div class="checkbox-custom checkbox-inline">
                    <input type="checkbox" id="inputChecked" checked="">
                    <label for="inputChecked">选中1</label>
                  </div>
                  <div class="checkbox-custom checkbox-inline">
                    <input type="checkbox" id="inputChecked2" checked="">
                    <label for="inputChecked2">选中2</label>
                  </div>
                  <div class="checkbox-custom checkbox-inline">
                    <input type="checkbox" id="inputChecked3" checked="">
                    <label for="inputChecked3">选中3</label>
                  </div>
                </div>
              </div>
              <div class="hr-line-dashed"></div>
              <div class="form-group draggable">
                <div class="col-sm-12 col-sm-offset-3">
                  <button class="btn btn-primary" type="button">保存内容</button>
                  <button class="btn btn-white" type="button">取消</button>
                </div>
              </div>
            </form>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
      <!--tool right -->
      <div class="col-sm-8">
        <div class="panel">
          <div class="panel-heading">
            <h5 class="inl-blk">拖拽左侧表单元素到此区域</h5>
            <div class="head-tools">
              请选择显示的列数：
              <select id="n-columns">
                <option value="1">显示1列</option>
                <option value="2">显示2列</option>
              </select>
            </div>
          </div>
          <div class="panel-body">
            <div class="row form-body form-horizontal form-edit" contenteditable="true">
              <div class="col-md-12 droppable sortable"></div>
              <div class="col-md-6 droppable sortable" style="display: none;"></div>
              <div class="col-md-6 droppable sortable" style="display: none;"></div>
            </div>
            <div class="btn-div">
              <button type="submit" class="btn btn-warning" data-clipboard-text="testing" id="copy-to-clipboard" style="display: block;margin-bottom: 10px;">
                复制代码
              </button>
              <button type="submit" class="btn btn-success" id="downloadFile">
                下载代码
              </button>
              <input type="text" class="form-control file-name" placeholder="请输入文件名" style="display: inline-block;width: 100px;margin-left:10px;">
              <em>（如果没有输入文件名或者后缀不为.html，则默认为form.html）</em>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="http://cdn.bootcss.com/zui/1.8.1/lib/jquery/jquery.js"></script>
  <script src="http://cdn.bootcss.com/zui/1.8.1/js/zui.min.js"></script>
  <!--jquery-ui.js 无法替代，使用方法与zui的dragsable和droppable有区别  -->
  <script src="js/jquery-ui-1.10.4.min.js"></script>
  <script src="js/plugins/beautifyhtml/beautifyhtml.js"></script>
  <script>
    $(document).ready(function () {
      setup_draggable();
      $("#n-columns").on("change", function () {
        var v = $(this).val();
        if (v === "1") {
          var $col = $(".form-body .col-md-12").toggle(true);
          $(".form-body .col-md-6 .draggable").each(function (i, el) {
            $(this).remove().appendTo($col)
          });
          $(".form-body .col-md-6").toggle(false)
        } else {
          var $col = $(".form-body .col-md-6").toggle(true);
          $(".form-body .col-md-12 .draggable").each(function (i, el) {
            $(this).remove().appendTo(i % 2 ? $col[1] : $col[0])
          });
          $(".form-body .col-md-12").toggle(false)
        }
      });
      $("#copy-to-clipboard").on("click", function () {
        var $copy = $(".form-body").clone().appendTo(document.body);
        $copy.find(".tools, :hidden").remove();
        $.each(["draggable", "droppable", "sortable", "dropped", "ui-sortable", "ui-draggable", "ui-droppable",
          "form-body"
        ], function (i, c) {
          $copy.find("." + c).removeClass(c).removeAttr("style")
        });
        var html = html_beautify($copy.html()); //要复制的HTML代码
        $copy.remove();
        $modal = get_modal(html).modal("show");
        $modal.find(".btn").remove();
        $modal.find(".modal-title").html("复制HTML代码");
        $modal.find(":input:first").select().focus();
        return false
      })
    });
    var setup_draggable = function () {
      $(".draggable").draggable({
        appendTo: "body",
        helper: "clone"
      });
      $(".droppable").droppable({
        accept: ".draggable",
        helper: "clone",
        hoverClass: "droppable-active",
        drop: function (event, ui) {
          $(".empty-form").remove();
          /* $(ui.draggable)?http://www.runoob.com/jqueryui/api-droppable.html
           * event
           * 类型：Event
           * ui
           * 类型：Object
           */
          var $orig = $(ui.draggable);
          if (!$(ui.draggable).hasClass("dropped")) {
            var $el = $orig.clone().addClass("dropped").css({
              "position": "static",
              "left": null,
              "right": null
            }).appendTo(this);
            var id = $orig.find(":input").attr("id");
            if (id) {
              id = id.split("-").slice(0, -1).join("-") + "-" + (parseInt(id.split("-").slice(-1)[0]) + 1);
              $orig.find(":input").attr("id", id);
              $orig.find("label").attr("for", id)
            }
            $(
              '<p class="tools col-sm-12 col-sm-offset-3">						<a class="edit-link">编辑HTML<a> | 						<a class="remove-link">移除</a></p>'
            ).appendTo($el)
          } else {
            if ($(this)[0] != $orig.parent()[0]) {
              var $el = $orig.clone().css({
                "position": "static",
                "left": null,
                "right": null
              }).appendTo(this);
              $orig.remove()
            }
          }
        }
      }).sortable()
    };
    var get_modal = function (content) {
      var modal = $(
        '<div class="modal" style="overflow: auto;" tabindex="-1">	<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><a type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</a><h4 class="modal-title">编辑HTML</h4></div><div class="modal-body ui-front">	<textarea class="form-control" 	style="min-height: 200px; margin-bottom: 10px;font-family: Monaco, Fixed">' +
        content + '</textarea><button class="btn btn-success">更新HTML</button></div>				</div></div></div>').appendTo(
        document.body);
      return modal
    };
    // 事件委托
    $(document).on("click", ".edit-link", function (ev) {
      // 编辑HTML
      var $el = $(this).parent().parent();
      var $el_copy = $el.clone();
      var $edit_btn = $el_copy.find(".edit-link").parent().remove();
      var $modal = get_modal(html_beautify($el_copy.html())).modal("show");
      $modal.find(":input:first").focus();
      $modal.find(".btn-success").click(function (ev2) {
        var html = $modal.find("textarea").val();
        if (!html) {
          $el.remove()
        } else {
          $el.html(html);
          $edit_btn.appendTo($el)
        }
        $modal.modal("hide");
        return false
      })
    });
    // 事件委托
    $(document).on("click", ".remove-link", function (ev) {
      // 移除
      $(this).parent().parent().remove()
    });
  </script>
  <script>
    // 下载文件
    function fake_click(obj) {
      var ev = document.createEvent("MouseEvents");
      ev.initMouseEvent(
        "click", true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null
      );
      obj.dispatchEvent(ev);
    }

    function export_raw(name, data) {
      var urlObject = window.URL || window.webkitURL || window;

      var export_blob = new Blob([data]);

      var save_link = document.createElementNS("http://www.w3.org/1999/xhtml", "a")
      save_link.href = urlObject.createObjectURL(export_blob);
      save_link.download = name;
      fake_click(save_link);
    }
    // var test = document.getElementsByTagName('html')[0].outerHTML;

    $('#downloadFile').click(function () {
      var $copy = $(".form-body").clone().appendTo(document.body);
      $copy.find(".tools, :hidden").remove();
      $.each(["draggable", "droppable", "sortable", "dropped", "ui-sortable", "ui-draggable", "ui-droppable",
        "form-body"
      ], function (i, c) {
        $copy.find("." + c).removeClass(c).removeAttr("style")
      });
      var download = html_beautify($copy.html()); //要下载的HTML代码
      console.log(download);
      var fileName = $('.file-name').val()
      var reg = "(.html)$";
      var re = new RegExp(reg);
      if (!fileName || !re.test(fileName)) {
        fileName = 'form.html'
      }
      console.log(fileName)
      export_raw(fileName, download);
      $copy.remove();
    });
  </script>
</body>

</html>